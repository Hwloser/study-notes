## 哈希分片

后台随数据规约的越来越大，单机明显无法存储庞大的数据量，只能依靠大规模集群对数据进行存储和处理，所以系统的可靠性也称为了一个很重要的一个点。

目前主流的大数据存储于计算机系统通常采用横向扩展的方式支持系统的可靠性，即通过增加机器数量来获得水平扩展能力。与此对应，对于待存储的海量数据，需要通过哈希分片来讲数据进行切分分配到各个机器中。

## 哈希取模法

假设有k台物理机，通过以下哈希函数可实现数据分片：

H(key)=hash(key) mod K

根据求出来的结果来决定存储到那台物理机上。

这一种分片实现起来非常简单，但是缺乏灵活性，比如新增一台物理机到集群，哈希函数随机变化：

H(key)=hash(key) mod (K+1)

按照这样哈希函数来算，之前的数据和物理机之间的映射就全部被打乱，所有数据需要重新按照改变后的哈希函数再分配。

## 虚拟桶

以《大数据如知路》中以Membase数据库举例，

以下关键单:

1. 引入虚拟桶层，所有数据通过哈希函数存储到对应的虚拟桶，一个虚拟桶会存储多条数据。
2. Membase通过内存表来管理物理机与虚拟桶的映射，一个物理机可以对应多个虚拟桶
3. 当加入新机器时，只需要改变虚拟桶和物理机的映射表就能实现扩展

## 一致性哈希

关键点：

1. 一致性哈希将哈希数值空间按照大小组成一个首尾相接的环状序列。
2. 对于每台机器，可根据其ip和端口进过哈希函数映射到哈希数值空间内。
3. 每个机器节点记录环中的前驱节点和后继节点位置，这样就变成了一个真正的有向环。